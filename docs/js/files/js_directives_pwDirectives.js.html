<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>js/directives/pwDirectives.js - Postworld</title>
    <link rel="stylesheet" href="">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="stylesheet" href="../assets/css/custom.css">
    <link rel="stylesheet" href="../assets/vendor/bootstrap/css/bootstrap.css">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
</head>
<body class="yui3-skin-sam">
<div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
        <h1 class="brand" style="padding: 10px 16px 10px; height: 20px; line-height: 20px; margin-left: 0;">
	    <img alt="Postworld" src="../assets/css/logo.png" style="max-height: 65%;" title="Postworld">
            Postworld
        </h1>
	<div class="nav">
            <li class="divider-vertical"></li>
            <li>
                <p class="navbar-text">
                    API Docs for Version: <b>1.9</b>
                </p>
            </li>
        </div>
        <form class="navbar-form pull-right" style="line-height: 40px; height: 40px;">
            <input style="margin-top: 0;" type="text" class="search-query" placeholder="Search for classes/modules..." data-obj='["classes/loadPost", "classes/pwPostShareReport", "modules/Directives", "modules/Postworld", "modules/Services"]'>
        </form>
    </div>
</div>
<div class="container">
    <div class="row">
        <div class="span3">
	    <div>
	        <h3>APIs</h3>
	        <div id="sidebar">
	            <ul id="main-nav" class="nav nav-tabs" style="margin-bottom:0;">
	                <li class="active"><a href="#classes" data-toggle="tab">Classes</a></li>
	                <li><a href="#modules" data-toggle="tab">Modules</a></li>
	            </ul>
	    
	            <div id="api-tabview-filter">
	                <input type="search" placeholder="Type to filter APIs">
	            </div>
	    
	            <div class="tab-content" style="border: 1px solid #DDD; border-top:0;">
	                <div class="tab-pane active" id="classes">
	                    <ul id="api-classes" class="nav nav-list">
	                            <li><a href="../classes/loadPost.html">loadPost</a></li>
	                            <li><a href="../classes/pwPostShareReport.html">pwPostShareReport</a></li>
	                    </ul>
	                </div>
	    
	                <div class="tab-pane" id="modules">
	                    <ul id="api-modules" class="nav nav-list">
	                            <li><a href="../modules/Directives.html">Directives</a></li>
	                            <li><a href="../modules/Postworld.html">Postworld</a></li>
	                            <li><a href="../modules/Services.html">Services</a></li>
	                    </ul>
	                </div>
	            </div>
	        </div>
	    </div>
        </div>
        <div class="span9">
                <form id="options-form" class="form-inline pull-right">
                    Show:
                    <label for="api-show-inherited" class="checkbox">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected" class="checkbox">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private" class="checkbox">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated" class="checkbox">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </form>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <div class="page-header">
                            <h1>js/directives/pwDirectives.js <small>File</small></h1>
                        </div>
                        
                        <div class="file">
                            <pre class="prettyprint linenums">
                        &#x27;use strict&#x27;;
                        /*____  _               _   _                
                         |  _ \(_)_ __ ___  ___| |_(_)_   _____  ___ 
                         | | | | | &#x27;__/ _ \/ __| __| \ \ / / _ \/ __|
                         | |_| | | | |  __/ (__| |_| |\ V /  __/\__ \
                         |____/|_|_|  \___|\___|\__|_| \_/ \___||___/
                        											 
                        ////////// ------------ DIRECTIVES ------------ //////////*/
                        
                        /**
                         * @module Postworld
                         * @submodule Directives
                         */
                        
                        ////////// PW GLOBALS //////////
                        // This directive sets the $pw service object into the local scope
                        // Just specifiy which scope object to map it to
                        // EXAMPLE : &lt;div pw-globals=&quot;pw&quot;&gt;&lt;pre&gt;{{ pw | json }}&lt;/pre&gt;&lt;/div&gt; 
                        postworld.directive( &#x27;pwGlobals&#x27;,
                        	[ &#x27;$pw&#x27;, &#x27;_&#x27;, &#x27;$log&#x27;,
                        	function( $pw, $_, $log ){
                        	return{
                        		scope:{
                        			pwGlobals:&quot;=&quot;,
                        		},
                        		link : function( $scope, element, attrs ){
                        			$scope.pwGlobals = $pw;
                        		}
                        	}
                        }]);
                        
                        ////////// PW INCLUDE //////////
                        postworld.directive(&#x27;pwInclude&#x27;, function($log, $timeout, pwData) {
                        	// Used to include a Postworld template partial within an isolated scope
                        	// Post and meta data can be easily make available in the template
                        	// Example : &lt;div pw-include=&quot;galleries/gallery-frame&quot; include-post=&quot;post&quot;&gt;&lt;/div&gt;
                        	// Uses ng-include to include the file at {pwTemplatesPath}/galleries/gallery-frame.html
                        	// And double binds the passed post object into the isolated scope 
                        	return {
                        		restrict: &#x27;EA&#x27;,
                        		//replace: true,
                        		template: &#x27;&lt;div ng-include=&quot;includeUrl&quot; class=&quot;pw-include&quot; ng-class=&quot;includeClass&quot;&gt;&lt;/div&gt;&#x27;,
                        		scope:{
                        			// Must use an isolated scope, to allow for using multiple include directives in the same page
                        			vars:&quot;=includeVars&quot;,		//	Vars to assigned within the include as $scope.vars
                        			includeMeta:&quot;=&quot;,		// 	Object to be assigned as $scope.meta within the include
                        			includePost:&quot;=&quot;,		//	Object to be assigned as $scope.post within the include
                        			includeEnable:&quot;=&quot;,		// 	Whether or not to actually enable the load the include
                        			includeClass:&quot;@&quot;,		//	Class(es) to be added to the include element
                        		},
                        		link: function($scope, element, attrs){
                        
                        			var setTemplateUrl = function(){
                        				var pwInclude = attrs.pwInclude;
                        				var parts = pwInclude.split(&#x27;/&#x27;);
                        				if( parts.length &lt; 2 ){
                        					$log.debug( &#x27;pwInclude : ERROR : Include must contain 2 parts, dir/basename.&#x27; )
                        					return false;
                        				}
                        				if($scope.includeEnable !== false )
                        					$scope.includeUrl = pwData.pw_get_template( { subdir: parts[0], view: parts[1] } );
                        				else
                        					$scope.includeUrl = &#x27;&#x27;;
                        				//$log.debug(&#x27;pwInclude : &#x27; + attrs.pwInclude, $scope.includeUrl );
                        			}
                        
                        			attrs.$observe( &#x27;pwInclude&#x27;, function( pwInclude ){
                        				setTemplateUrl();
                        			});
                        
                        			$scope.$watch(&#x27;includeEnable&#x27;, function(val){
                        				setTemplateUrl();
                        			});
                        
                        			// Pipe post data into the isolated include scope as &#x27;post&#x27; object
                        			$scope.$watch(&#x27;includePost&#x27;, function( val ){
                        				//$log.debug( &#x27;pwInclude : includePost&#x27;, val );
                        				if( !_.isUndefined( val ) )
                        					$scope.post = $scope.includePost;
                        			}, 1 );
                        
                        			// Pipe post data into the isolated include scope as &#x27;meta&#x27; object
                        			$scope.$watch(&#x27;includeMeta&#x27;, function( val ){
                        				//$log.debug( &#x27;includePanel : includeMeta&#x27;, val );
                        				if( !_.isUndefined( val ) )
                        					$scope.meta = $scope.includeMeta;
                        			}, 1 );
                        
                        			// Watch Include Enable and hide element if it&#x27;s not enabled
                        			$scope.$watch(&#x27;includeEnable&#x27;, function( val ){
                        				//$log.debug( &#x27;pwInclude : includeEnable&#x27;, val );
                        				if( !_.isUndefined( val ) &amp;&amp; !_.isNull( val ) ){
                        					if( val === false )
                        						element.addClass( &#x27;ng-hide&#x27; );
                        					else
                        						element.removeClass( &#x27;ng-hide&#x27; );
                        				}
                        			}, 1 );
                        
                        		}
                        	};
                        });
                        
                        
                        
                        ///// LOAD PANEL /////
                        // DEPRECIATED AS OF VERSION 1.88
                        // Instead use pw-include
                        postworld.directive(&#x27;loadPanel&#x27;, function($log, $timeout, pwData) {
                        	return {
                        		restrict: &#x27;EA&#x27;,
                        		replace: true,
                        		template: &#x27;&lt;div ng-include=&quot;templateUrl&quot; class=&quot;load-panel&quot; ng-class=&quot;panelClass&quot;&gt;&lt;/div&gt;&#x27;,
                        		scope:{
                        			// Must use an isolated scope, to allow for using multiple panel directives in the same page
                        			panelVars:&quot;@&quot;,		//	Vars to assigned within the panel as $scope.vars
                        			panelMeta:&quot;=&quot;,		// 	Object to be assigned as $scope.meta within the panel
                        			panelPost:&quot;=&quot;,		//	Object to be assigned as $scope.post within the panel
                        			panelEnable:&quot;=&quot;,	// 	Whether or not to actually enable the load panel
                        			panelClass:&quot;@&quot;,		//	Class(es) to be added to the panel element
                        		},
                        		link: function($scope, element, attrs){
                        
                        			attrs.$observe( &#x27;loadPanel&#x27;, function( loadPanel ){
                        				if($scope.panelEnable !== false )
                        					$scope.templateUrl = pwData.pw_get_template( { subdir: &#x27;panels&#x27;, view: loadPanel } );
                        				$log.debug(&#x27;loadPanel :&#x27; + attrs.loadPanel, $scope.templateUrl );
                        			});
                        
                        			attrs.$observe( &#x27;panelVars&#x27;, function( val ){
                        				var panelVars = $scope.$eval( $scope.panelVars );
                        				$log.debug( &#x27;loadPanel : panelVars :&#x27;, panelVars );
                        				if( !_.isUndefined( panelVars ) )
                        					$scope.vars = $scope.vars;
                        			});
                        
                        			// Pipe post data into the isolated panel scope as &#x27;post&#x27; object
                        			$scope.$watch(&#x27;panelPost&#x27;, function( val ){
                        				$log.debug( &#x27;loadPanel : panelPost&#x27;, val );
                        				if( !_.isUndefined( val ) )
                        					$scope.post = $scope.panelPost;
                        			}, 1 );
                        
                        			// Pipe post data into the isolated panel scope as &#x27;meta&#x27; object
                        			$scope.$watch(&#x27;panelMeta&#x27;, function( val ){
                        				$log.debug( &#x27;loadPanel : panelMeta&#x27;, val );
                        				if( !_.isUndefined( val ) )
                        					$scope.meta = $scope.panelMeta;
                        			}, 1 );
                        
                        			/*
                        			$scope.getPanelClass = function(){
                        				// Add the class of the load panel name
                        				var classes = attrs.loadPanel;
                        				if( !_.isNull( $scope.panelClass ) &amp;&amp; !_.isUndefined( $scope.panelClass ) )
                        					classes = classes + &quot; &quot; + $scope.panelClass;
                        				return classes;
                        			}
                        			*/
                        
                        		}
                        	};
                        });
                        
                        
                        ///// POSTWORLD SANITIZE DIRECTIVE /////
                        postworld.directive(&#x27;pwSanitize&#x27;, function() {
                        	return {
                        		require: &#x27;?ngModel&#x27;,
                        		link: function( $scope, element, attrs, ngModel ) {
                        
                        			function process( value ){
                        				switch( attrs.pwSanitize ){
                        					case &#x27;id&#x27;:
                        						value = value.replace( &#x27; &#x27;, &#x27;-&#x27;, &#x27;m&#x27; );
                        						break;
                        				}
                        				return value;
                        			};
                        
                        			function update(){
                        				var value = String( element.context.value );
                        				value = process( value );
                        				ngModel.$setViewValue( value );
                        				ngModel.$render();
                        			}
                        
                        			$scope.$watch( attrs.ngModel, function(n,o) {
                        				update();
                        			});
                        			
                        			/*
                        			ngModel.$formatters.push(function(value) {
                        				return value;
                        			});
                        			*/
                        
                        		},
                        	}
                        });
                        
                        
                        ///// POSTWORLD SRC DIRECTIVE /////
                        postworld.directive(&#x27;pwSrc&#x27;, function( $log ) {
                        	return {
                        		scope:{
                        		  pwSrc:&quot;=pwSrc&quot;
                        		},
                        		link: function( scope, element, attrs ) {
                        			scope.$watch( &#x27;pwSrc&#x27;, function(){
                        				attrs.$set(&#x27;src&#x27;, scope.pwSrc );
                        			});
                        		},
                        	}
                        });
                        
                        
                        ///// POSTWORLD HREF DIRECTIVE /////
                        postworld.directive(&#x27;pwHref&#x27;, function() {
                        	return {
                        		scope:{
                        		  pwHref:&quot;=pwHref&quot;
                        		},
                        		link: function(scope, element, attrs) {
                        			
                        			scope.$watch( &#x27;pwHref&#x27;, function(){
                        				attrs.$set(&#x27;href&#x27;, scope.pwHref );
                        			});
                        
                        			//var fullPathUrl = &quot;http://.../&quot;;
                        			/*
                        			if(element[0].tagName === &quot;A&quot;) {
                        				attrs.$set(&#x27;href&#x27;,fullPathUrl + attrs.fullPath);
                        			} else {
                        				attrs.$set(&#x27;src&#x27;,fullPathUrl + attrs.fullPath);
                        			}*/
                        
                        		},
                        	}
                        });
                        
                        
                        ///// POSTWORLD BACKGROUND IMAGE /////
                        // Add a background image style to an element
                        postworld.directive(&#x27;pwBackgroundImage&#x27;, function( $log ) {
                        	return {
                        		scope:{
                        		  pwBackgroundImage:&quot;=&quot;
                        		},
                        		link: function( $scope, element, attrs ) {
                        			$scope.$watch( &#x27;pwBackgroundImage&#x27;, function(val){
                        				element.css( &#x27;background-image&#x27;, &#x27;url(&quot;&#x27;+val+&#x27;&quot;)&#x27; );
                        			});
                        		},
                        	}
                        });
                        
                        
                        ///// POSTWORLD EVAL DIRECTIVE /////
                        // Evaluates a string as javascript at the time of loading
                        // Works well for initializing third-party libraries
                        postworld.directive(&#x27;pwEval&#x27;, function($timeout, $log) {
                        	return {
                        		scope:{
                        		  pwEval:&quot;@&quot;,		// A string to evaluate as Javascript
                        		  evalTimeout:&quot;@&quot;,	// (optional) Numerical period to timeout before evaluating, in milliseonds
                        		  evalContext:&quot;@&quot;,	// (optional) Context in which to evaluate. Options : scope / window
                        		  evalWatch:&quot;=&quot;,	// (optional) An expression to watch for changes, on change re-evalute
                        		},
                        		link: function($scope, element, attrs) {
                        
                        			if( _.isUndefined( $scope.evalTimeout ) )
                        				$scope.evalTimeout = 0;
                        			if( _.isUndefined( $scope.evalContext ) )
                        				$scope.evalContext = &#x27;window&#x27;;
                        
                        			///// EVAL TIMEOUT /////
                        			var evaluate = function(){
                        				$timeout(
                        					function(){
                        						$log.debug( &#x27;pw-eval : &#x27;, $scope.pwEval );
                        						try{
                        							if( $scope.evalContext == &#x27;scope&#x27; )
                        								$scope.$eval($scope.pwEval);
                        							else
                        								eval($scope.pwEval);
                        						}
                        						catch(err){
                        							$log.debug(&#x27;pw-eval : ERROR : &#x27; + $scope.pwEval, err);
                        						}
                        					}, $scope.evalTimeout
                        				);
                        			}
                        			evaluate();
                        
                        			///// EVAL WATCH /////
                        			var firstWatch = true;
                        			$scope.$watch( &#x27;evalWatch&#x27;, function(val){
                        				if( firstWatch ){
                        					firstWatch = false;
                        					return;
                        				}
                        				evaluate();
                        			});
                        
                        
                        		},
                        	}
                        });
                        
                        ///// POSTWORLD NEW TARGET DIRECTIVE /////
                        postworld.directive(&#x27;pwTarget&#x27;, function( $log ) {
                        	return {
                        		link: function( scope, element, attrs ) {
                        
                        			scope.$watch(
                        				function(scope) {
                        					// watch the &#x27;new target&#x27; expression for changes
                        					return scope.$eval( attrs.pwTarget );
                        				},
                        				function(value) {
                        					// If a boolean is provided
                        					if( _.isBoolean( value ) ){
                        						if( value )
                        							attrs.$set(&#x27;target&#x27;, &quot;_blank&quot; );
                        						else
                        							attrs.$set(&#x27;target&#x27;, &quot;_self&quot; );
                        					}
                        					// Set target to the specified value
                        					else if( !_.isNull( value ) &amp;&amp; !_.isUndefined( value ) ){
                        						attrs.$set(&#x27;target&#x27;, value );
                        					}
                        				}
                        			);
                        
                        		},
                        	}
                        });
                        
                        
                        ///// SUBMIT ON ENTER /////
                        // Submit on Enter, without a real form
                        postworld.directive(&#x27;ngEnter&#x27;, function() {
                        
                          	return function(scope, element, attrs) {
                        			
                        		element.bind(&quot;keydown keypress&quot;, function(event) {
                        		  	if(event.which === 13) {
                        				scope.$apply(function(){
                        					if( attrs.ngEnter )
                        						scope.$eval(attrs.ngEnter);
                        					else
                        						scope.$eval(&quot;submit()&quot;);
                        				});
                        				event.preventDefault();
                        			}
                        		});
                        		
                        	};
                        
                        });
                        
                        
                        ///// PREVENT DEFAULT ON CLICK /////
                        postworld.directive(&#x27;preventDefaultClick&#x27;, function() {
                        		return {
                        			restrict: &#x27;A&#x27;,
                        			link: function (scope, element) {
                        				element.bind(&#x27;click&#x27;, function (event) {
                        					//event.stopPropagation();
                        					event.preventDefault();
                        				});
                        			}
                        		};
                        	});
                        
                        
                        ///// PREVENT DEFAULT ON CLICK /////
                        postworld.directive(&#x27;stopPropagationClick&#x27;, function() {
                        		return {
                        			restrict: &#x27;A&#x27;,
                        			link: function (scope, element) {
                        				element.bind(&#x27;click&#x27;, function (event) {
                        					event.stopPropagation();
                        				});
                        			}
                        		};
                        	});
                        
                        
                        ///// SELECT ON CLICK /////
                        postworld.directive(&#x27;selectOnClick&#x27;, function () {
                            return {
                                restrict: &#x27;A&#x27;,
                                link: function (scope, element, attrs) {
                                    element.on(&#x27;click&#x27;, function () {
                                        this.select();
                                    });
                                }
                            };
                        });
                        
                        
                        ///// AUTO FOCUS /////
                        // Automatically focuses the input field it&#x27;s applied to
                        postworld.directive(&#x27;pwAutofocus&#x27;, function($timeout) {
                        	return {
                        		link: function ( scope, element, attrs ) {
                        			scope.$watch( attrs.ngFocus, function ( val ) {
                        				$timeout( function () { element[0].focus(); } );
                        			}, true);
                        		}
                        	};
                        });
                        
                        
                        /*_   _                        ____ _               
                         | | | | _____   _____ _ __   / ___| | __ _ ___ ___ 
                         | |_| |/ _ \ \ / / _ \ &#x27;__| | |   | |/ _&#x60; / __/ __|
                         |  _  | (_) \ V /  __/ |    | |___| | (_| \__ \__ \
                         |_| |_|\___/ \_/ \___|_|     \____|_|\__,_|___/___/
                        ////////////// POSTWORLD HOVER CLASS //////////////*/
                        // Adds specified class(es) to an element on mouseover
                        // And removes the classes on mouseleave
                        // Optional attributes include hover-on-delay and hover-off-delay
                        // Which are specified in the number of milliseconds
                        // Before the class is added / removed 
                        
                        postworld.directive(&#x27;pwHoverClass&#x27;, function ( $timeout ) {
                            return {
                                restrict: &#x27;A&#x27;,
                                scope: {
                                    pwHoverClass: &#x27;@&#x27;,	// classes to add when hovered
                                    hoverOnDelay: &#x27;@&#x27;,	// milliseconds
                                    hoverOffDelay: &#x27;@&#x27;,	// milliseconds
                                },
                                link: function ( $scope, element, attrs ) {
                                	// mouseIsOver // Variable to track if mouse is currently over
                                	// Prevents the hover class from getting locked on
                                	// In the case that the ON delay is greater than the OFF delay
                                	// And the mouse passes on and off the element in less time than their difference
                                	var mouseIsOver = false;
                        
                                    element.on(&#x27;mouseenter&#x27;, function() {
                                    	mouseIsOver = true;
                                    	if( _.isUndefined($scope.hoverOnDelay) )
                                    		$scope.hoverOnDelay = 0;
                                    	$timeout( function(){
                                    		if( mouseIsOver == true )
                        	            		element.addClass($scope.pwHoverClass);
                                    	}, parseInt($scope.hoverOnDelay) );
                                    });
                                    element.on(&#x27;mouseleave&#x27;, function() {
                                    	mouseIsOver = false;
                                        if( _.isUndefined($scope.hoverOffDelay) )
                                    		$scope.hoverOffDelay = 0;
                                        $timeout( function(){
                                    		element.removeClass($scope.pwHoverClass);
                                    	}, parseInt($scope.hoverOffDelay) );
                                    });
                                }
                            };
                        })
                        
                        
                        
                        /*_                                             
                         | |    __ _ _ __   __ _ _   _  __ _  __ _  ___ 
                         | |   / _&#x60; | &#x27;_ \ / _&#x60; | | | |/ _&#x60; |/ _&#x60; |/ _ \
                         | |__| (_| | | | | (_| | |_| | (_| | (_| |  __/
                         |_____\__,_|_| |_|\__, |\__,_|\__,_|\__, |\___|
                        									 |___/     
                        ////////// POSTWORLD LANGUAGE ACCESS //////////*/
                        postworld.directive( &#x27;pwLanguage&#x27;, [function(){
                        		return { 
                        			controller: &#x27;pwLanguageCtrl&#x27;
                        		};
                        }]);
                        
                        postworld.controller(&#x27;pwLanguageCtrl&#x27;,
                        		[&#x27;$scope&#x27;,&#x27;$window&#x27;,
                        		function($scope, $window) {
                        
                        			$scope.lang = &#x27;en&#x27;;
                        			$scope.lang_options = {
                        				&#x27;en&#x27;: &#x27;English&#x27;,
                        				&#x27;es&#x27;: &#x27;Espa√±ol&#x27;
                        			};
                        
                        			$scope.language = $window.pwSiteLanguage;
                        			//$scope.l = $window.pwSiteLanguage;
                        						
                        		/*
                        		$scope.parseHTML = function(string){
                        				return $sce.parseAsHtml(string);
                        		};
                        		*/
                        
                        }]);
                        
                        
                        
                        /*_____ _                            _   
                         |_   _(_)_ __ ___   ___  ___  _   _| |_ 
                           | | | | &#x27;_ &#x60; _ \ / _ \/ _ \| | | | __|
                           | | | | | | | | |  __/ (_) | |_| | |_ 
                           |_| |_|_| |_| |_|\___|\___/ \__,_|\__|
                        
                        ////////// POSTWORLD TIMEOUT //////////*/
                        // Run an action in an isolated scope on a timeout
                        
                        postworld.directive(&#x27;pwTimeout&#x27;, function( $timeout ) {
                        	return {
                        		scope:{
                        			pwTimeout:&quot;@&quot;,
                        			timeoutAction:&quot;@&quot;,
                        			timeoutMultiplier:&quot;@&quot;,
                        		},
                        		link: function( $scope, element, attrs ) {
                        			
                        			var timeoutPeriod = ( _.isUndefined( $scope.timeoutMultiplier ) || _.isEmpty( $scope.timeoutMultiplier ) ) ?
                        				$scope.pwTimeout : $scope.pwTimeout * $scope.timeoutMultiplier;
                        
                        			$timeout( function(){
                        				// Evaluate passed local function
                        				$scope.$eval( $scope.timeoutAction );
                        				// Destroy Scope
                        				$scope.$destroy();
                        			}, parseInt(timeoutPeriod) ); // 
                        
                        			$scope.addClass = function( classes ){
                        				element.addClass( classes );
                        			}
                        		},
                        	}
                        });
                        
                        
                        
                        /**
                          ____                 _ _  __ _      
                         / ___|  ___ _ __ ___ | | |/ _(_)_  __
                         \___ \ / __| &#x27;__/ _ \| | | |_| \ \/ /
                          ___) | (__| | | (_) | | |  _| |&gt;  &lt; 
                         |____/ \___|_|  \___/|_|_|_| |_/_/\_\
                        
                         * Adds a &#x27;ui-scrollfix&#x27; class to the element when the page scrolls past it&#x27;s position.
                         * @param [offset] {int} optional Y-offset to override the detected offset.
                         *   Takes 300 (absolute) or -300 or +300 (relative to detected)
                         */
                        postworld.directive(&#x27;uiScrollfix&#x27;, [&#x27;$window&#x27;, function ($window) {
                        	return {
                        		require: &#x27;^?uiScrollfixTarget&#x27;,
                        		link: function (scope, elm, attrs, uiScrollfixTarget) {
                        			var top = elm[0].offsetTop,
                        					$target = uiScrollfixTarget &amp;&amp; uiScrollfixTarget.$element || angular.element($window);
                        
                        			if (!attrs.uiScrollfix) {
                        				attrs.uiScrollfix = top;
                        			} else if (typeof(attrs.uiScrollfix) === &#x27;string&#x27;) {
                        				// charAt is generally faster than indexOf: http://jsperf.com/indexof-vs-charat
                        				if (attrs.uiScrollfix.charAt(0) === &#x27;-&#x27;) {
                        					attrs.uiScrollfix = top - parseFloat(attrs.uiScrollfix.substr(1));
                        				} else if (attrs.uiScrollfix.charAt(0) === &#x27;+&#x27;) {
                        					attrs.uiScrollfix = top + parseFloat(attrs.uiScrollfix.substr(1));
                        				}
                        			}
                        
                        			function onScroll() {
                        				// if pageYOffset is defined use it, otherwise use other crap for IE
                        				var offset;
                        				if (angular.isDefined($window.pageYOffset)) {
                        					offset = $window.pageYOffset;
                        				} else {
                        					var iebody = (document.compatMode &amp;&amp; document.compatMode !== &#x27;BackCompat&#x27;) ? document.documentElement : document.body;
                        					offset = iebody.scrollTop;
                        				}
                        				if (!elm.hasClass(&#x27;ui-scrollfix&#x27;) &amp;&amp; offset &gt; attrs.uiScrollfix) {
                        					elm.addClass(&#x27;ui-scrollfix&#x27;);
                        				} else if (elm.hasClass(&#x27;ui-scrollfix&#x27;) &amp;&amp; offset &lt; attrs.uiScrollfix) {
                        					elm.removeClass(&#x27;ui-scrollfix&#x27;);
                        				}
                        			}
                        
                        			$target.on(&#x27;scroll&#x27;, onScroll);
                        
                        			// Unbind scroll event handler when directive is removed
                        			scope.$on(&#x27;$destroy&#x27;, function() {
                        				$target.off(&#x27;scroll&#x27;, onScroll);
                        			});
                        		}
                        	};
                        }]).directive(&#x27;uiScrollfixTarget&#x27;, [function () {
                        	return {
                        		controller: [&#x27;$element&#x27;, function($element) {
                        			this.$element = $element;
                        		}]
                        	};
                        }]);
                        
                        
                        postworld.directive(&#x27;pwScrollfix&#x27;, function( $window, $log, $timeout ) {
                        	return {
                        		scope:{
                        			pwScrollfix:&quot;@&quot;,
                        			scrollfixYOffset:&quot;@&quot;,
                        			scrollfixYClass:&quot;@&quot;,
                        		},
                        		link: function( $scope, element, attrs ) {
                        			
                        			// Define default classes
                        			$scope.scrollfixYClass = ( !_.isUndefined( $scope.scrollfixYClass ) ) ?
                        				$scope.scrollfixYClass : &quot;scrollfix-y&quot;;
                        
                        			$scope.addClass = function( classes ){
                        				element.addClass( classes );
                        			}
                        
                        			$scope.getIdHeight = function( elementId ){
                        				var element = angular.element( document.querySelector( &#x27;#&#x27; + elementId ) ).context;
                        				return element.offsetHeight;
                        			}
                        
                        			$scope.pageYOffset = function(){
                        				return $window.pageYOffset;
                        			}
                        
                        			function onYScroll(){
                        				var yOffset = $scope.$eval( $scope.scrollfixYOffset );
                        				//$log.debug( &#x27;yOffset&#x27;, yOffset  );
                        				//$log.debug( &#x27;pageYOffset&#x27;, $window.pageYOffset  );
                        	
                        				// If specified Y offset is greater than how far the page is scrolled vertically
                        				if( yOffset &lt; $window.pageYOffset ){
                        					
                        					// Add class to the element
                        					element.addClass( $scope.scrollfixYClass );
                        				}
                        				else{
                        					// Remove class from the element
                        					element.removeClass( $scope.scrollfixYClass );
                        				}
                        			}
                        
                        			// If scrollfixYOffset is defined
                        			if( !_.isUndefined( $scope.scrollfixYOffset ) )
                        				// Run onYScroll function when window is scrolled 
                        				angular.element($window).bind(&quot;scroll&quot;, onYScroll);
                        
                        		},
                        	}
                        });
                        
                        
                        //////////////////// ADMIN ////////////////////
                        ////////// TEMPLATES //////////
                        postworld.directive( &#x27;pwAdminTemplates&#x27;,
                        	[ &#x27;$pw&#x27;, &#x27;_&#x27;, &#x27;$log&#x27;,
                        	function( $pw, $_, $log ){
                        	return{
                        		scope:{
                        			pwAdminTemplates:&quot;=&quot;,
                        		},
                        		link : function( $scope, element, attrs ){
                        			var templates = $_.get( $pw, &#x27;admin.templates&#x27; );
                        			$scope.pwAdminTemplates = templates;
                        		}
                        	}
                        }]);
                        
                        
                        ////////// SIDEBARS //////////
                        postworld.directive( &#x27;pwSidebars&#x27;,
                        	[ &#x27;$pw&#x27;, &#x27;_&#x27;, &#x27;$log&#x27;,
                        	function( $pw, $_, $log ){
                        	return{
                        		scope:{
                        			pwSidebars:&quot;=&quot;,
                        		},
                        		link : function( $scope, element, attrs ){
                        			var sidebars = $_.get( $pw, &#x27;admin.sidebars&#x27; );
                        			$scope.pwSidebars = sidebars;
                        		}
                        	}
                        }]);
                        
                        
                        ////////// SHARE LINK //////////
                        postworld.directive( &#x27;pwShareLink&#x27;,
                        	[ &#x27;$pw&#x27;, &#x27;_&#x27;, &#x27;$log&#x27;,
                        	function( $pw, $_, $log ){
                        	return{
                        		scope:{
                        			pwShareLink:&#x27;=&#x27;,		// The expression to map the share link to
                        			shareLinkPostId:&#x27;=&#x27;,	// The ID of the post which to generate the share link for
                        			shareLinkDynamic:&#x27;@&#x27;	// If &#x27;true&#x27;, sets up a watch on the value of shareLinkPostId
                        		},
                        		link : function( $scope, element, attrs ){
                        
                        			// Generates the share link URL
                        			var generateShareLink = function(postId){
                        				if( _.isUndefined(postId) )
                        					return &#x27;&#x27;;
                        
                        				var userId = $_.get( $pw, &#x27;user.ID&#x27; );
                        				var shareLink = $pw.paths.home_url + &quot;/?u=&quot; + userId + &quot;&amp;p=&quot; + postId;
                        				$log.debug(&#x27;SHARE LINK : &#x27;, shareLink);
                        				return shareLink;
                        			}
                        
                        			// If share link is dynamic, such as value = &#x27;true&#x27;
                        			if( $_.stringToBool( $scope.shareLinkDynamic ) ){
                        				$scope.$watch( &#x27;shareLinkPostId&#x27;, function(postId){
                        					$scope.pwShareLink = generateShareLink(postId);
                        				});
                        			}
                        
                        			// Set the share link value
                        			$scope.pwShareLink = generateShareLink($scope.shareLinkPostId);
                        			
                        		}
                        	}
                        }]);
                        
                        
                        
                        
                        
                        /**
                         * Loads a post template and injects it with data.
                         *
                         * @class loadPost
                         * @constructor
                         * @param {String} postId Optional. Post ID
                         * @param {String} postView Which registered view template to use.
                         * @param {Object} postQuery Query vars to derive post from.
                         * @param {string} postClass Optional. Classes to add to the template element.
                         * @param {string} postLoading Optional. An expression to assign a loading boolean.
                         * 
                         */
                        postworld.directive(&#x27;loadPost&#x27;,
                        	[ &#x27;$log&#x27;, &#x27;$timeout&#x27;, &#x27;pwData&#x27;, &#x27;_&#x27;,
                        	function( $log, $timeout, $pwData, $_ ) {
                        	return {
                        		restrict: &#x27;A&#x27;,
                        		replace: true,
                        		template: &#x27;&lt;div ng-include=&quot;templateUrl&quot; ng-class=&quot;postClass&quot;&gt;&lt;/div&gt;&#x27;,
                        		scope : {
                        			postId:&#x27;=&#x27;,
                        			postView:&#x27;@&#x27;,
                        			postQuery:&#x27;=&#x27;,
                        			postClass:&#x27;@&#x27;,
                        			postLoading:&#x27;=&#x27;
                        		},
                        		link: function( $scope, element, attrs ){
                        			var init = function(){
                        				///// DETECT MODE /////
                        				if( $scope.postId != null )
                        					$scope.mode = &#x27;id&#x27;;
                        				else
                        					$scope.mode = &#x27;query&#x27;;
                        
                        				$log.debug( &#x27;loadPost : MODE : &#x27;, $scope.mode );
                        
                        				///// SWITCH : MODE /////
                        				switch( $scope.mode ){
                        					///// POST FROM ID
                        					case &#x27;id&#x27;:
                        						loadPostFromId();
                        						break;
                        					///// POST FROM QUERY /////
                        					case &#x27;query&#x27;:
                        						loadPostFromQuery();
                        						break;
                        				}
                        			}
                        			
                        			/**
                        			 * Loads a post via post ID
                        			 * @method loadPostFromId
                        			 */
                        			var loadPostFromId = function(){
                        				$scope.postLoading = true;
                        				$pwData.getPost( {post_id:$scope.postId} ).then(
                        					function(response) {
                        						$scope.postLoading = false;
                        						var post = response.data;
                        						if( !_.isEmpty(post) ){
                        							$scope.post = post;
                        							setTemplateUrl();
                        						}
                        					},
                        					function(response){}
                        				);
                        			}
                        
                        			/**
                        			 * Loads a post via query
                        			 */
                        			var loadPostFromQuery = function(){
                        
                        				if( !_.isObject($scope.postQuery) ){
                        					throw { message:&quot;Postworld [directive] loadPost : Wrong query format provided in post-query attribute.&quot; }
                        					return false;
                        				}
                        
                        				// Setup query
                        				var query = $scope.postQuery;
                        				query.posts_per_page = 1;
                        
                        				$scope.postLoading = true;
                        				$pwData.pwQuery( query ).then(
                        					function(response) {
                        						$scope.postLoading = false;
                        						if( _.isArray( response.data.posts ) ){
                        							if( !_.isEmpty( response.data.posts ) ){
                        								$scope.post = response.data.posts[0];
                        								setTemplateUrl();
                        							}
                        						}
                        
                        					},
                        					function(response){}
                        				);
                        			}
                        
                        			/**
                        			 * Sets the template URL
                        			 */
                        			var setTemplateUrl = function(){
                        
                        				var postType = $_.get( $scope, &#x27;post.post_type&#x27; ); 
                        				if( !postType )
                        					postType = &#x27;post&#x27;;
                        
                        				var view = $scope.postView;
                        				if( view == null )
                        					view = &#x27;list&#x27;;
                        
                        				$scope.templateUrl = $pwData.pw_get_template({
                        					subdir: &#x27;posts&#x27;,
                        					post_type: postType,
                        					view: view
                        					});
                        	
                        			}
                        
                        			init();
                        
                        		}
                        	};
                        }]);
                        
                        
                        postworld.directive(&#x27;pwDataGet&#x27;, [ &#x27;$log&#x27;, &#x27;_&#x27;, &#x27;pwData&#x27;, &#x27;$pw&#x27;, function( $log, $_, $pwData, $pw ){
                        	return{
                        		scope:{
                        			pwDataGet:&quot;@&quot;,
                        		},
                        		link: function( $scope, element, attrs ){
                        			$log.debug(&quot;ACTIVATE : pwDataGet&quot;, element);
                        			element.html( JSON.stringify( $_.get( $pwData, $scope.pwDataGet ) ) );
                        		}
                        
                        	}
                        }]);
                        
                            </pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/jquery/jquery-1.8.2.min.js"></script>
<script src="../assets/vendor/bootstrap/js/bootstrap.js"></script>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script src="../assets/js/yuidoc-bootstrap.js"></script>
<script>prettyPrint();</script>
</body>
</html>
