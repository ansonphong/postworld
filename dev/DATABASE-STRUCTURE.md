Postworld Database Structure
======

## Index of Tables

0. [Post Meta](#post-meta)
0. [User Meta](#user-meta)
0. [Comment Meta](#comment-meta)
0. [Post Points](#post-points)
0. [Comment Points](#comment-points)
0. [User Shares](#user-shares)
0. [User Roles](#user-roles)
0. [Favorites](#favorites)
0. [Feeds](#feeds)
0. [Cron Logs](#cron-logs)

------

## Post Meta
__Default Table Name:__ *wp_posworld_* __post_meta__

### Columns

#### __post_id__ : *integer*

#### __post_class__ : *string*
- Used by pw_query posts by __class__
- Examples of classes:
  - __editorial__ - On posts from approved authors and editors
  - __community__ - On posts from community members

#### __post_format__ : *string*
__Default__: *standard*

- Used by pw_query media by __format__
- Used with _ng-switch_ on templates to change how post of various formats are displayed
- Examples of formats:
  - __standard__ - A regular post
  - __video__ - On posts which have a primary _link_url_ which is a video
  - __audio__ - On posts which have a primary _link_url_ which is a audio

#### __link_url__ : *string*
- Used to associate a specific link URL with a post
- Used by templates for featured links, videos and audio files for embedding

#### __post_points__ : *integer*
- The total number of points voted to a post

#### __rank_score__ : *integer*
- The real-time rank-score of a post, based on `calculate_rank_score()` Method

------

## User Meta
__Default Table Name:__ *wp_posworld_* __user_meta__

### Columns

#### __user_id__ : *integer*
- Wordpress User ID

#### __post_points__ : *integer*
__Data__ : *cached*
- Total points which have been voted to the user's posts

#### __post_points_meta__ : *integer*
- Cached data which breaks down the attribution of points by post_type
- __Data__ : *cached*
  - Generated by : `calculate_user_posts_points()` PHP Method
  - Cached by : `cache_user_posts_points()` PHP Method

``` javascript
{
	post_type : {
		post : 242,
		link : 523,
		blog : 123,
		event : 12
	}
}
```

#### __comment_points__ : *integer*
__Data__ : *cached*
- Total points which have been voted to the user's comments

#### __share_points__ : *integer*
__Data__ : *cached*
- Total number of share points of the user's shares (my_shares + my_post_shares)

#### __share_points_meta__ : *JSON*
- Cached JSON Object which breaks down the user's share points by:
  - __my_shares__ : From posts that I have shared
  - __my_post_shares__ : Number of share points to my posts

- __Data__ : *cached*
  - Generated by : `user_share_report($user_id)`
  - Cached by : `cache_user_share_report($user_id)`

``` javascript
{
	my_shares : 312,
	my_post_shares : 512
}

```


#### __share_report__ : *JSON*
- Cached JSON Object which documents all share activity on behalf of the user, including:
  - __my_shares__ : From posts that the user has shared
  - __my_post_shares__ : Number of share points to the user's posts

__Data__ : *cached*
  - Generated by : `user_share_report($user_id)`
  - Cached by : `cache_user_share_report($user_id)`

``` javascript
{
	my_shares : {
		{
			post_id : 8723,	// post_id
			shares : 385,	// shares
			last_time : 	// UNIX Timestamp of the last share
		},
		{
			post_id : 3498,
			shares : 551,
			last_time :
		},
		...
	}

	my_post_shares : { // others who have shared my posts
		{
			post_id : 9348,
			total_shares : 385,
			users_shares:{ 
				{
					user_id : 843,
					shares : 235,
					last_time : 
				},
				{
					user_id : 843,
					shares : 984,
					last_time : 
				},
				...
			}
		},
		{
			post_id : 1252,
			total_shares : 385,
			users_shares:{ 
				{
					user_id : 2352,
					shares : 456,
					last_time : 
				},
				{
					user_id : 2632,
					shares : 234,
					last_time : 
				},
				...
			}
		},
	}
}

```

#### __post_relationships__ : *JSON*
- Outlines the user's relationships to posts, in terms of votes that they have vast

- __viewed__ : Used to generate a report of which content the user has viewed

- __has_voted.recent__ : Used to calculate how often a user is commenting on the post
  - If the user is voting on comments too often, disable comment voting temporarily

__Anatomy:__

``` javascript
{
	viewed:[12,25,23,16,47,24,58,112,462,78,234,25,128],
	favorites:[12,16,25],
	read_later:[58,78],
	has_voted:{
		recent : { 
			{
				post_id:242,
				points:1,
				time_voted:{{UNIX TIMESTAMP}}
			},
			{
				post_id:942,
				points:-1,
				time_voted:{{UNIX TIMESTAMP}}
			},
		}
	}
}
```

#### __comment_relationships__ : *JSON*
- Outlines the user's relationships to comments, in terms of votes that they have vast

- __has_voted.recent__ : Used to calculate how often a user is commenting on the post
  - If the user is voting on comments too often, disable comment voting temporarily

__Anatomy:__

``` javascript
{
	has_voted:{
		recent : {
			{
				comment_id:24152,
				points:1,
				time_voted:{{UNIX TIMESTAMP}}
			},
			{
				comment_id:43532,
				points:-1,
				time_voted:{{UNIX TIMESTAMP}}
			},
		}
	}
}
```

#### __location_city__ : *string*
- Used to display and query a user by city

#### __location_region__ : *string*
- Used to display and query a user by region (province/state/territory)

#### __location_country__ : *string*
- Used to display and query a user by country

------

## Comment Meta
__Default Table Name:__ *wp_posworld_* __comment_meta__

- Used to cache data for comments

### Columns

#### __comment_id__ : *integer*

#### __post_id__ : *integer*

#### __comment_points__ : *integer*

------

## Post Points
__Default Table Name:__ *wp_posworld_* __post_points__

- Used to store a record of all points cast to all posts

### Columns

#### __post_id__ : *integer*
- The post ID of the post being voted on

#### __author_id__ : *integer*
- The user ID of the author who created the post

#### __user_id__ : *integer*
- The user ID of the user who is casting a vote

#### __post_points__ : *integer*
- The number of points cast in the vote

#### __time__ : *integer*
- The time which the vote was cast

------

## Comment Points
__Default Table Name:__ *wp_posworld_* __comment_points__

- Used to store a record of all points cast to all comments

### Columns

#### __comment_post_id__ : *integer*
- The post ID of the post that the comment is on

#### __post_author_id__ : *integer*
- The user ID of the author who created the post which the comment is on

#### __comment_id__ : *integer*
- The comment ID of the comment

#### __comment_author_id__ : *integer*
- The user ID of the author of the comment

#### __user_id__ : *integer*
- The user ID of the user who is casting the vote

#### __comment_points__ : *integer*
- The number of points being voted to the comment

#### __time__ : *integer*
- The time that the vote was cast

------

## User Shares
__Default Table Name:__ *wp_posworld_* __user_shares__

- Used to store a record of all posts shared by users

### Columns

#### __user_id__ : *integer*
- The user ID of the user sharing
- Tracked when a link like this is loaded :
  - _http://realitysandwich.com/?p=2453&u=24  
  **p** = page ID  
  **u** = user ID  

#### __post_id__ : *integer*
- The post ID of the post which is being shared

#### __author_id__ : *integer*
- The user ID of the user who authored the post

#### __recent_ips__ : *string*
- A list of the most recent 100 IP addesses which have loaded the share URL
- Used to discount counting multiple hits from the same visitor

#### __shares__ : *integer*
- The number of shares by that user to that post

#### __last_time__ : *integer*
- The most recent time the share URL was loaded by a unique IP

------

## User Roles
__Default Table Name:__ *wp_posworld_* __user_roles__

- Used to store meta data relating the user roles

### Columns

#### __role_name__ : *string*
- The name of the role

#### __vote_points__ : *integer*
- The number of points which users with that role can cast

------

## Favorites
__Default Table Name:__ *wp_posworld_* __favorites__

- Used to store a record of all favorites by user ID and post ID
- Will be used to calculate 'reccomended pages' by favorites
  - _'People who liked this, also liked this.'_
- Will be used to reccomend friends of similar interests
  - _'People who also favorited this : {{List Users}}'_

### Columns

#### __post_id__ : *integer*

#### __user_id__ : *integer*

------

## Feeds
__Default Table Name:__ *wp_posworld_* __feeds__
- Stores registered query vars, cached feed outlines and performance data for feeds
- Used by the __load-feed__ JS directive to load cached feeds
- Used by the following PHP Methods:
  - `pw_register_feed()`
  - `pw_load_feed()`
  - `pw_cache_feed()`

### Columns

#### __feed_id__ : *string*
- The ID of the feed, described by `pw_register_feed()`

#### __feed_query__ : *string*
- __Format__ : *JSON*
- The registered query args for `pw_query()` which generates the __feed_outline__
- Stored in JSON format

#### __feed_outline__ : *string*
- Contains a list of _comma deliniated integers_ 
- Describes the __post IDs__ in the order retured by `pw_query()`
- `24,12,51,467,235,364,364,3453`

#### __time_start__ : *integer* 
- __Format__ : *UNIX Timestamp*
- The starting time of the last run of `cache_feed()`

#### __time_end__ : *integer*
- __Format__ : *UNIX Timestamp*
- The ending time of the last run of `cache_feed()`

#### __timer__ : *integer*
- __Format__ : *milliseconds*
- The number of miliseconds it took to generate the current feed outline

------

## Cron Logs
__Default Table Name:__ *wp_posworld_* __cron_logs__
- Stores a log of the cron tasks performed

### Columns

#### __cron_run_id__ : *integer*
- __Method__ : *auto-increment*
- An auto-incremented ID generated by MySQL of the cron task

#### __function_type__ : *string*
- The name of the function which generated the cron task
  - ie. `pw_cache_feed`

#### __process_id__ : *string*
- __(Optional)__
- The ID of the feed or post_type processed, if applicable

#### __time_start__ : *integer*
- __Format__ : *UNIX Timestamp*
- Time that the cron task started

#### __time_end__ : *integer*
- __Format__ : *UNIX Timestamp*
- Time that the cron task ended
 
#### __timer__ : *integer*
- __Format__ : *milliseconds*
- Time that the cron task took to process

#### __posts__ : *integer*
- __(Optional)__
- The number of posts processed, if applicable

#### __query_args__ : *string*
- __Format__ : *JSON*
- __(Optional)__
- If there are __query args__ associated with the __function type__, store them here









